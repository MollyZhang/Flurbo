{{extend 'layout.html'}}


<div class="container">
    <h1>Initialize your budget system</h1>
    <div id="target_income"></div>
    <div id="target_budget"></div>
</div>

<script id="template_income" type="text/ractive">
    <span>Your monthly income: </span>
    {% #if editing %}
        <input value="{% income %}" />
        <span class="btn btn-default btn-sm" on-click='save'>Save</span>
    {% else %}
        <span>{% income %}</span>
        <span class="btn btn-default btn-sm" on-click="edit">edit</span>
    {% /if %}
</script>

<script>
$(function() {
    var INCOME = new Ractive({
        el: '#target_income',
        template: '#template_income',
        delimiters: ['{%', '%}'],
        tripleDelimiters: ['{%%', '%%}'],
        data: {
            editing: true,
            income: 0
        }
    });
    INCOME.on("save", function() {
        INCOME.set("editing", false);
        income = INCOME.get('income');
        $.ajax("{{=URL('default', 'save_income', user_signature=True)}}",
            {
            method: 'POST',
            data: {
                income: income
                }
            }
        );
    });
    INCOME.on("edit", function() {
        INCOME.set("editing", true);
    });
});
</script>

<script id="template_budget" type="text/ractive">
    <div class="container">
        <table class="table">
        <thead>
            <tr>
                <th>Budget Category</th>
                <th>Budget Per Week</th>
            </tr>
        </thead>
        <tbody>
            {% #categories %}
            <tr>
                <td>key</td>
                <td>value</td>
            </tr>
            {% /categories %}

            {% #if adding_budget %}
            <tr>
                <td><input placeholder="new budget category" id="category_name" /></td>
                <td><input placeholder="0" id="category_budget" /></td>
            </tr>
            {% /if %}
        </tbody>
        </table>
        {% #if !adding_budget %}
            <div class="btn btn-default" on-click="add-budget">add budget category</div>
        {% else %}
            <div class="btn btn-default" on-click="save-budget">save budget category</div>
        {% /if %}
    </div>
</script>

<script>
$(function() {
    var BUDGET = new Ractive({
        el: '#target_budget',
        template: '#template_budget',
        delimiters: ['{%', '%}'],
        tripleDelimiters: ['{%%', '%%}'],
        data: {
            adding_budget: false,
            categories: {}
        }
    });

    //load initial set of budget categories
    $.ajax("{{=URL('default', 'load_budget_categories', user_signature=True)}}",
        {
        method: 'POST',
        success: function (data) {
            BUDGET.set('categories', data['categories']);
            console.log(BUDGET.get('categories'));
            }
        }
  );

    BUDGET.on('add-budget', function(){
        BUDGET.set('adding_budget', true);
    });

    BUDGET.on('save-budget', function(){
        var name = $('#category_name').val();
        var amount = $('#category_budget').val();
        $.ajax("{{=URL('default', 'save_budget', user_signature=True)}}",
            {
            method: 'POST',
            data: {
                name: name,
                amount: amount
                }
            }
        );
        BUDGET.set('adding_budget', false);
        var updated_category = BUDGET.get('categories');
        updated_category[name] = amount;
        BUDGET.set('categories', updated_category);
        console.log(BUDGET.get('categories'));
    });

});
</script>