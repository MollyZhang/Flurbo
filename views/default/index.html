{{extend 'layout.html'}}


<div class="container">
    <div class="jumbotron">
        <h3>Initialize your budget system</h3>
    </div>
    <div id="target_income"></div>
    <div id="target_budget"></div>
    <div id="target_fixed"></div>
</div>

<script id="template_income" type="text/ractive">
    <div class='panel panel-success'>
        <div class='panel-heading'>
        <span>Your monthly income: </span>
        {% #if editing %}
            <input value="{% income %}" />
            <span class="btn btn-default btn-sm" on-click='save'>Save</span>
        {% else %}
            <span>{% income %}</span>
            <span class="btn btn-default btn-sm" on-click="edit">edit</span>
        {% /if %}
        </div>
    </div>
</script>

<script>
$(function() {
    var INCOME = new Ractive({
        el: '#target_income',
        template: '#template_income',
        delimiters: ['{%', '%}'],
        tripleDelimiters: ['{%%', '%%}'],
        data: {
            editing: true,
            income: 0
        }
    });
    INCOME.on("save", function() {
        INCOME.set("editing", false);
        income = INCOME.get('income');
        $.ajax("{{=URL('default', 'save_income', user_signature=True)}}",
            {
            method: 'POST',
            data: {
                income: income
                }
            }
        );
    });
    INCOME.on("edit", function() {
        INCOME.set("editing", true);
    });
});
</script>

<script id="template_budget" type="text/ractive">
    <div class="panel panel-success">
        <div class="panel-heading">
            <h3>Here is the budget categories that changes over time: </h3>
            {% #if !adding_budget %}
                <div class="btn btn-default" on-click="add-budget">add budget category</div>
            {% else %}
                <div class="btn btn-default" on-click="save-budget">save budget category</div>
            {% /if %}
        </div>
        <table class="table">
        <thead>
            <tr>
                <th>Budget Category</th>
                <th>Budget Per Week</th>
            </tr>
        </thead>
        <tbody>
            {% #categories:i %}
            <tr>
                <td>{% categories[i]['name'] %}</td>
                <td>{% categories[i]['budget'] %}</td>
            </tr>
            {% /categories %}

            {% #if adding_budget %}
            <tr>
                <td><input placeholder="new budget category" id="category_name" /></td>
                <td><input placeholder="0" id="category_budget" /></td>
            </tr>
            {% /if %}
        </tbody>
        </table>
    </div>
</script>

<script>
$(function() {
    var BUDGET = new Ractive({
        el: '#target_budget',
        template: '#template_budget',
        delimiters: ['{%', '%}'],
        tripleDelimiters: ['{%%', '%%}'],
        data: {
            adding_budget: false,
            categories: []
        }
    });

    //load initial set of budget categories
    $.ajax("{{=URL('default', 'load_budget_categories', user_signature=True)}}",
        {
        method: 'POST',
        success: function (data) {
            BUDGET.set('categories', data['categories']);
            }
        }
  );

    BUDGET.on('add-budget', function(){
        BUDGET.set('adding_budget', true);
    });

    BUDGET.on('save-budget', function(){
        var name = $('#category_name').val();
        var amount = $('#category_budget').val();
        $.ajax("{{=URL('default', 'save_budget', user_signature=True)}}",
            {
            method: 'POST',
            data: {
                name: name,
                amount: amount
                }
            }
        );
        BUDGET.set('adding_budget', false);
        var new_category = {"name": name, "budget": amount};
        var updated_category = BUDGET.get('categories');
        updated_category.push(new_category);
        BUDGET.set('categories', updated_category);
    });

});
</script>

<script id="template_fixed" type="text/ractive">
    <div class="panel panel-success">
        <div class="panel-heading">
            <h3>Here is the budget categories that's fixed per month: </h3>
            {% #if !adding %}
                <div class="btn btn-default" on-click="add">add fixed spending</div>
            {% else %}
                <div class="btn btn-default" on-click="save">save fixed spending</div>
            {% /if %}
        </div>
        <table class="table">
        <thead>
            <tr>
                <th>Fixed Spending Name</th>
                <th>Amount Per Month</th>
            </tr>
        </thead>
        <tbody>
            {% #fixed_spendings:i %}
            <tr>
                <td>{% fixed_spendings[i]['name'] %}</td>
                <td>{% fixed_spendings[i]['amount'] %}</td>
            </tr>
            {% /fixed_spendings %}

            {% #if adding %}
            <tr>
                <td><input placeholder="new fixed spending" id="spending_name" /></td>
                <td><input placeholder="0" id="spending_amount" /></td>
            </tr>
            {% /if %}
        </tbody>
        </table>
    </div>
</script>

<script>
$(function() {
    var FIXED = new Ractive({
        el: '#target_fixed',
        template: '#template_fixed',
        delimiters: ['{%', '%}'],
        tripleDelimiters: ['{%%', '%%}'],
        data: {
            adding: false,
            fixed_spendings: []
        }
    });

    //load initial set of budget categories
    $.ajax("{{=URL('default', 'load_fixed_spendings', user_signature=True)}}",
        {
        method: 'POST',
        success: function (data) {
            FIXED.set('fixed_spendings', data['fixed_spendings']);
            }
        }
  );

    FIXED.on('add', function(){
        FIXED.set('adding', true);
    });

    FIXED.on('save', function(){
        var name = $('#spending_name').val();
        var amount = $('#spending_amount').val();
        $.ajax("{{=URL('default', 'save_fixed_spending', user_signature=True)}}",
            {
            method: 'POST',
            data: {
                name: name,
                amount: amount
                }
            }
        );
        FIXED.set('adding', false);
        var new_spending = {"name": name, "amount": amount};
        var updated_spending = FIXED.get('fixed_spendings');
        updated_spending.push(new_spending);
        FIXED.set('fixed_spendings', updated_spending);
    });

});
</script>